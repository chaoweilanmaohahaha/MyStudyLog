# 虚拟文件系统

所有的操作系统至少需要一个标准的文件系统，但是系统中同时支持多种文件系统是必须的，那么linux在设计的时候就在标准的文件系统和用户进程之间加上了一个层来进行交互，这个层就叫做虚拟文件系统。那么虚拟文件系统有什么帮助呢？由于在一个系统上用户可能想要对多个不同的文件系统进行读写，使用不同的方法进行操作一定是不能满意的，VFS的一个作用就是让文件操作统一化。我们可以将我们目前能知道的文件系统分为下面几类：

* 基于磁盘的文件系统：也就是可以说是真实标准的文件系统
* 虚拟的文件系统：比如proc文件系统
* 网络文件系统

## 模型

当我们正在操作一个文件的时候，对于内核和用户而言的感触是不同的。在用户层面上来讲，用户只是在操作一个**文件描述符**。当内核中一个文件被打开并且检查下来进入是合法的时候，一个文件描述符才被正常分配，注意的是这个文件描述符的概念是针对进程而言，两个进程确实可以使用着相同的文件描述符，但是它们可能操作的并不是同一个文件。内核中操作的是**i节点**，每一个文件甚至是目录都可以是一个i节点，但是i节点上并不会存放当前这个文件的名字。

### i节点

那么i节点上具体有什么？一些文件的元数据一级文件的内容。如果作为一个目录来说，它的文件内容就是目录内容，也就是包含了它目录下的文件的i节点号以及文件名。

### 链接

链接建立了文件与文件之间的关系，其中包括了软连接和硬链接。软连接就是指在某个i节点下存放了一个文件的路径名，这个链接会在目标文件删除后依旧存在，每一个软连接都会单独分配一个i节点存放目标文件的路径名字符串。那么硬链接的话就是指生成的这个目录项指向了已经存在的一个i节点号，也就是说共同指向了同一个i节点。

### 接口

那么用户如果想要通过VFS和内核中的文件进行交互，就要通过内核给出的编程接口，这里就是有关文件的、目录的以及文件系统相关的一些系统调用了。对于用户空间来说，只要内核中一个文件被打开了，那么用户层面来说只和文件描述符有关了，和底层的这个文件就没有什么关系了。这里顺便提一下，在操作文件的过程中可能会使用到文件指针，而这个只对随机访问的文件有作用，那么对于一些类似管道、设备文件来说就不允许随机访问了。

## VFS的架构

这里主要看看在内核中虚拟文件系统中常用的那些数据结构都是怎么样的。


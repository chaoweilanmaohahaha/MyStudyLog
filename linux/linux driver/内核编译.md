# 内核编译方法

首先是到kernel.org网站上下载内核源代码，这里值得一说的是我是用ubuntu来做这个实验的，我的ubuntu是4.1.10-genetic版本的，而我下载的内核代码的版本是4.1.11版本的。

###### 1、预处理部分

在编译之前我们要下载一些必要的模块，这些模块可能对于内核代码，对于接下来的编译过程都有所帮助。

```
sudo apt-get install libncurses5-dev libssl-dev 
sudo apt-get install build-essential openssl 
sudo apt-get install zlibc minizip 
sudo apt-get install libidn11-dev libidn11
```

当我们安装完成这些模块之后就可以正式进入编译。

###### 2、编译内核

第二步就是要编译我们的内核代码，生成所谓的内核树。首先解压缩内核源代码，这个你解压缩到什么地方似乎没有什么特别的要求。然后就开始编译。

###### make mrproper

目的是为了清除编译过程中产生的中间文件；

###### make clean 

目的是为了清除上一次编译的中间文件

###### make menuconfig

这是使用图形化的界面对所需要编译的内核进行人性化的裁剪，如果使用默认配置的话就直接退出图形化界面就行了。

当我们完成以上步骤就可以真正的make了，不过编译一次内核代码实在要耗费太多时间，因此可以根据你的电脑的配置多开几个线程来帮助编译提速。

###### make -j4

我就是开了四个线程进行编译的。

###### 3、安装内核模块与内核

###### make module_install 

这是安装内核模块的命令

###### make install 

正式进入安装模块，这两步花不了太长时间。

当我们完成上述两步后，可以说内核已经安装完成了，那么怎么查看自己安装的内核呢，我们重启虚拟机，然后在开机界面时长按shift键进入设置界面，然后点击进入高级设置选项界面，其中就可以选择自己的内核版本了。当你进入系统后，可以用uname -r指令来查看目前的内核版本。

###### 安装好内核后，正式进入驱动编写的测试，详见1、构造和运行模块
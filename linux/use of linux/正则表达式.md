# 正则表达式

如果你作为系统管理员，正则表达式确实是一个很重要的东西。正则表达式的基本目的就是处理字符串，它通过一些特殊符号的帮助，能够让用户简单操作类似查找、删除、替换。借助正则表达式您能够把这些操作做的很漂亮。

在 Linux 中如果你想在命令中使用正则表达式，那么必须保证这些程序支持正则，而部分程序是不支持正则表达式的，只支持 bash 通配符。正则表达式的最基本的一个应用就是过滤垃圾邮件，根据邮件内容来匹配一定的特征。

正则表达式其实严格意义上讲有两种，一种是基础正则表达式，另一种是扩展正则表达式。

## 基础正则表达式

使用正则表达式的时候要注意你所使用的语系，不同的语系编码的数据并不相同，从而导致数据选取会出问题。比如说有的语系对于英文字母的编码是 a-z 连续的，而有的是小写字母和大写字母交替的。所以最后在取结果的时候会造成不相同的选取结果。所以在正则中一般使用 [:lower:] 代表全小写，[:upper:] 代表全大写，[:xdigit:] 代表全数字。

一般而言正则表达式有如下一些用法：

* [] 代表集合，代表的是其中的某一个字符，比如 [ae] 代表 a 或者 e；
* ^ 这个符号有几层特殊函数，如果配合这上面 [] 在其内部使用，可以表示取反，比如说 [\^ae] 表示不要 a 和 e；但是 ^ 的另一层意思是表示行首，比如 ^[ae] 代表某个串行首有 a 或者 e
* 有行首就有行尾。$ 代表的是行尾有某些字符，比如 [ae]$ 就是行尾包含 a 或者 e。
* . 一定包含一个任意字符，其实就是占一个位，这个位置必然有个字符；
* \* 代表了重复前一个字符 0 或者多次。注意的是可以重复 0 次，也就是不一定包含这个字符。
* {} 能够限定重复次数的范围，比如 o{2} 代表我需要重复这个 o 两次。 

## 扩展正则表达式

像 grep 默认是支持基础正则表达式，而假设需要使用扩展正则表达式，则需要加上 -E 选项，但是其实还有 egrep 命令是直接支持扩展正则的。

扩展正则在基础正则的情况下增加了一些符号表示：

* \+ ：重复前一个字符依一次或者多次，这一个就是至少会出现一次；
* ?：重复前一个字符零次或者一次；
* |：或的意思，也就是讲几个条件连接在一起，比如说 abc|aabc
* ()：群组，表示有这个模式的一组字符串，比如 a(b|ab)c

## 工具

1. sed 这个工具有很强的功能，比如说对字符串进行替换、删除、新增和选定功能，甚至还可以直接修改目标文件的办法。

2. 在 linux 中其实有很多格式化输出的工具，比如说有格式化打印的需求，希望能够输出得更漂亮，那么使用 printf 工具就可以有所帮助。

   ```
   printf '打印格式' 实际内容
   ```

   其实 printf 和 c 语言中的特别像，它在 linux 中最强的目的还是处理输出格式。

3. awk 这个工具，不像 sed 作用于一整行的处理，它比较倾向于一行当中数个字段来处理。

   ```
   awk '条件类型1{操作1} 条件类型2{操作2} ...' filename
   ```

   awk 处理行数据时默认的字段的分隔符为**空格键**或者 **Tab 键**。那么根据分隔符进行切分后，每一行的每个字段都是有变量名的，用 $1,$2 等来处理。而 $0 代表的是一整列的数据。对于 awk 命令而言，一般的处理流程包括：

   1. 读入第一行，讲第一行的数据写入 $0,$1,$2 等变量当中；
   2. 根据“条件类型”的限制，判断是否需要进行后面的“操作”；
   3. 完成所有操作与条件类型；
   4. 然后对于后续行的数据，重复前 1-3 步知道数据被处理完；

   但是除了 $0 这样的变量外，其实还有其他变量可以处理比如字段数、行数等信息，比如 NF、NR、FS。而上面提到的条件类型就是对选取的数据进行一定的删选，所以需要借助一些逻辑运算符，比如下面这个命令的使用：

   ```
   cat /etc/passwd | awk '{FS=":"} $3<10 {print $1 "\t" $3}'
   ```

   同时 awk 还有类似 BEGIN 和 END 这种变量来帮助对行操作进行矫正。

4. diff 和 patch

   文件比对也是一个经常会被用到的功能，比如你对于同一个软件包的不同版本之间，比较配置文件与原始文件的差异。所以它这种文本的比对一般是 ascii 文件级别的比对，diff 不仅能够对整个文件进行比对，同时也能对整个目录进行比对。和 diff 密切相关的一个命令就是 patch，这个命令可以将旧文件升级成新文件，但是其实这一步的第一步也是要比较新老文件的差异。要使用 `diff -Naur`  命令来制作补丁文件，随后使用 patch 命令修补文件。

5. cmp

   diff 的功能是比对 ascii 文件，并且它是以行为单位进行比对，而 cmp 是以字节为单位去比对，所以两者并不相同。cmp 一般是去比对二进制文件。

6. pr 打印命令。


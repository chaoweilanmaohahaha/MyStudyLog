# 系统设置和备份

这里简单谈一下可能出现的一些系统设置以及备份的问题。

## 设置

系统的设置有很多的条目，其中包括对于语系、日期、时间以及网络等方面的设置。你可以使用系统中的 setup 图形界面设置，也可以使用系统提供的很多软件命令。

### 网络

对于网络的设置，主要是配置一些网络参数，其中包括 IP、子网掩码、网关、DNS 主机 IP。这些参数可以手动设置，这适用于一些学术服务器以及公司内部网路的设置；它们也可以通过 DHCP 协议获取，这样就不需要任何手动设置。当然还可以使用拨号拿到动态 IP。

系统是通过网卡这个设备来连接网络，使用 `ifconfig -a` 来列出所有网卡。一般而言如果你是手动设置 IP，系统建议不要手动修改配置文件，只需要 nmcli 命令设置参数，它是通过一个**连接代号的名称**来设置是否上网。但是如果是 DHCP，就直接在其中设置成自动模式就可以了。

如果你需要修改主机名，可以通过 hostnamectl 来处理。

### 时间

除了使用 date 命令处理时间和输出，一般还需要调整系统的时区以及进行网络较时。

查看与调整时区可以使用 timedatectl 命令来处理，而校准时间要么直接使用 timedatectl 直接手动校准，要么使用 ntpdate 手动网络较时。

### 语系

语系主要分为系统语系和软件语系，localectl 可以查看系统的语系，而 locale 实际现实的 bash 中的语系。

### 防火墙

防火墙是一种网络数据的过滤方式，它根据服务器启动的服务，或者针对可信任的用户来开放。CentOS 如今默认的防火墙软件是 firewalld，它可以使用命令行 filrewall-cmd 来设置。

防火墙在设置的时候主要要注意几点，首先一般需要将设置的规则变为永久，否则下次重启防火墙时规则就会消失；其次用户可以针对不同的环境来设置规则，在 firewalld 目前只需要考虑其中的 public 项目，它可以根据服务、端口、富规则、接口等方面来设计规则。

最后值得注意的是，要想使得设置生效，则必须 reload 防火墙！

## 硬件数据收集

这里记录一些有关收集硬件数据的命令供参考：

* dmidecode：用来查看 CPU 型号、主板型号和内存相关的型号。
* lspci：查看母亲的硬件设备是什么
* lsusb：查看目前连接哪些 USB 设备
* iostat：实时查看磁盘的读写情况
* smartd：用来了解磁盘的健康状况，看看磁盘是好是坏，这里磁盘需要支持 SMART 协议；

## 备份

备份是系统损坏时等待恢复的救星，系统可能由于硬件问题造成损坏，也有可能因为用户的操作不当或者信息安全攻击事件导致数据问题。数据备份很重要，但是根据不同的角色备份的任务也是不同的。

那么在处理数据备份时需要考虑哪些因素呢？

* 备份哪些文件
* 通过什么备份媒介
* 考虑备份方式
* 备份的频率
* 备份使用的工具

一般而言需要备份的数据，一类是系统基本设置信息，一类是类似网络服务的内容；比如系统中比较重要的 /etc、/home、/var/spool/mail、/boot、/root、/usr/local/。网络服务的话需要备份特定的数据目录，而不需要备份的目录有 /dev、/proc、/sys、/run、/mnt、/media、/tmp。

你当然可以选择使用硬件来备份，比如使用外接 NAS 设备，或是外接 USB 的硬盘设备。当然这样做的弊端就是如果失窃则依旧没有完成数据的备份，所有相对较为安全的方式是使用异地备份系统，但是这也有个问题，那就是**带宽严重不足**。

如果是针对相当重要的服务，并且希望在最短的事件内恢复系统，此时只备份关键数据无法快速恢复系统，此时只能进行**完整备份**。但是如果一直进行完整备份，则消耗太大，所以一共有两种不同的策略：

* 累积备份：就是在前一次备份的情况下，备份有差异的文件。其中第一次是完整备份。优点是每次备份数量少，缺点是还原的效率很差；
* 差异备份：就是在第一次完整备份的情况下，备份有差异的文件。优点是还原效率高，缺点是每次备份的数量会累积增大

当然系统不是用来进行相当重要的服务，只需要备份重要数据也是可以的，只不过如果系统被攻击，则备份的数据可能也存在问题，即还原的系统也存在问题。


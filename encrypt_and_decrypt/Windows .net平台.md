# .NET 平台

Win32 平台逐渐过时，微软开始使用新一代的软件开发平台和运行平台，它支持多种编程语言，多种操作系统，多种用途，兼容多种硬件平台，它就是 .NET 平台。

## 概述

.NET 是什么？它是一个软件开发平台，它既可以运行在操作系统之上，又独立于操作系统。可以将它的功能和虚拟机的功能进行类比，只要安装了 .NET 框架，就可以运行 .NET 可执行程序。

如果从系统的角度来看，.NET 就是一系列运行在 Ring 3 级别的 DLL 文件。

所以对于这个平台而言，它又几个特点：

* 最终会被编译为 .NET 中间语言 IL
* 可执行文件变为保存 IL 指令和元数据，结构也发生改变
* 程序将不由 Windows 运行，而由框架运行，由 JIT 引擎负责在运行时进行编译再执行。

接下去将知道这个平台的一系列知识点。

## 介绍

首先要接触一些新的名词：

* MSIL：微软中间语言，大多数时候会被简称为 IL。在这个平台下可以运行许多种高级语言，但是编译后都会生成这种中间语言。那么对这个平台的代码进行分析，就是对 IL 进行跟踪和分析。
* CLR：通用语言运行时，这可以看程时一套标准资源。它是 IL 语言的运行环境，就像 Windows 是 PE 的运行环境一样。CLR 包括了面向对象的编程模型、安全模型、所有 .NET 基类、程序执行等等内容。
* 元数据和令牌：元数据代表了一个可执行文件所有的信息。而令牌用来标识唯一的一个元数据。
* JIT：即时编译，这是平台运行可执行程序的基本方式，这会将 IL 代码编译为本机指令。
* 程序集和模块：一个或者多个可执行代码的模块，加上一些必要的控制信息，就构成了一个程序集，程序集是 .NET 种可执行程序的基本单元。
* 类型与方法：这是面向对象程序设计中的概念。
* AppDomain：应用程序域，也就是类似进程的概念，让多个程序集构成一个应用程序域，随后代码只能访问本域内的数据。

## MSIL 和元数据

这两个概念是比较重要的，IL 会对元数据进行操作，而 IL 本身又是由元数据定义的。

在 PE 结构中，还有几个数据目录项是没有使用的，那么 .NET 平台就对它进行了扩展，其中有一项 Common Language Runtime Header。这个头部指向 .text 区块，这里存放的不再是汇编指令，而是 IL 代码和元数据。

CLR 头部藏在 .text 的第二项。

![CLR](..\img\CLR.png)
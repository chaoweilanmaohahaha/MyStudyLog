# 索引

有了物理存储的介质，那么此时就能将数据存储起来以便后续的使用，我们在使用相应的记录的时候免不了要对数据进行查找，那么下面考虑数据库中类似Select的查找语句，如果此时查找时指定了select * from table where a = 10，那么怎样快速根据某个字段的值快速查询出指定的记录，这就是索引所要完成的事。

## 结构

真正建立的索引就是根据某个键（字段）来构建一个数据结构来帮助查找。

**顺序文件**是元组按照逐渐进行排序之后产生的文件，那么关系中的元素就按照这个次序存在数据块中，对于这样的顺序文件，通常有如下方法建立索引：

### 稠密索引

稠密索引是在块中只存储存放记录的键以及指向记录的指针（我认为可以是逻辑地址也可以是结构地址），并且要保证一点，那就是键的顺序必须和文件存储顺序是一致的。这有个好处，那就是在查找指定的键的时候可以使用类似二分查找的方法，这样就可以进一步提高效率。

### 稀疏索引

稠密索引建立的是一对一索引，也就是说每一个记录几乎必然存在一个索引与之相对应；稀疏索引依然建立在顺序文件的基础上，在这里它只为每个数据存储块设一个键指针对，这样就会节省下许多的空间。那么查找的时候也可以基于一些查找策略，如果找到的键值是在某个区间内，则就可以确定在哪个存储块上。

### 多级索引

这个就是在索引上建立索引的方法构造多级索引，这个的目的是为了加快查找索引块，要想到索引块也存放在许多数据块上。

---

### 辅助索引

上面提到的索引方法都有一定的局限性，因为都受限于文件的存储方式必须是顺序文件，而辅助索引就可以作为任何的索引，用来查找指定的键值对应的记录。辅助索引和文件存储的位置并没有什么必然的联系，这也是它和以上的索引的一个最大区别。辅助索引不仅能在被组织成顺序文击的关系上建立附加的索引，还可以个其他一些数据结构添加索引。

当然因为辅助索引必然是稠密的，它同样有空间的利用问题，况且对于辅助索引有一个很大的问题在于如果一个索引键出现多次，就要建立一个多个索引块。因此可以在此处引入桶的中间层，将所有有着相同键值的指针存入一个桶中，而索引中的指针指向对应的桶就可以了。

### 倒排索引

这种索引方式多出现在信息检索领域，解决的问题一般是有关基于关键字的文档检索。一个文档可以将它看成是一个关系，而文档中可能出现的词看成是属性，那么我们可以在每个属性上建立值为TRUE的属性，并且我们建立的索引并不是单独的一个索引，而是将所有的索引合成一个。而真正建立的倒排索引借助上面提到的间接索引的概念可以更加节省空间，方法很简单，索引块是一个个单词，而指针指向了一个桶，桶中各项指向了该单词出现的文档。

随着现在人们的需求的变化，桶也可以编程有重要结构的记录集合，比如一个桶中包含了类型（标题、首部、锚、正文），这样会更细节的对文档进行查找，同时发掘文档之间存在的关系。

## B-树

上面提到了如果使用了一级索引和二级索引可以加快查找，但是在更为一般的系统中会选择使用叫B-树的一种数据结构，这种数据结构可以自动保证索引的层次，并可以保证每个块都能处于半满或者全满状态中。

介绍B树这个数据结构的内容应当留在数据结构内容中，这里就不展开了呗，但是只要知道B-树究竟在索引中有什么作用。B树只有最后一层藏着真正每个键对应的指针，而中间的层次中的块所包含的指针指向的是在保存键值在某个区间内的所有索引的记录。那么查找一个指定的记录就很简单了，这里具体有关B树的查找，增加，删除等不再赘述，和数据结构中的操作一致。

这里面只包括了几个特殊的，比如处理键值存在相同的情况，如果查询是处理一个范围内的键值，稍微对B树进行一些修改就能够满足要求。

## 散列表

散列表是另一种可以用来建立索引的数据结构，主要的思想就是通过一个散列函数h，将键值散列到B个桶中。

如果散列表中数据量很大，则这个散列表的存储需要借助辅助存储器，此时每一个桶就是由存储块为单位。那么对于这种形态的散列表，如果我需要添加一个索引则首先查看桶内还是否有空间，如果没空间了需要在该存储块上添加一个溢出块。那么删除的过程就是逆过程了，要注意的是如果删除了某条索引，那么需要查看是否要通过移动记录来合并同一链上的索引记录。

下面来一个稍微复杂一点的，如果将上面的散列方法叫做静态散列，则一种增强方法叫做可扩展散列。方法是我们需要给桶加入一个间接层，而这个间接层就是一个指针数组，它的长度总是2的幂次，散列函数的目的是计算K位的二级制序列，总是使用二进制位中其中i位作为散列的桶的标识。当我们进行插入的时候根据hash后最后的i位确定指针数组的位置。那么如果所选择的存储块没有空间了，那么需要将这个块进行分裂，将这个块上的内容拆分到两个新的存储块上，这两个存储块的散列标准按照i+1位二进制位来进行。

另一种策略叫做线性散列，这种策略的目的是为了控制上面可扩展散列的桶数量的快速增加，所以对桶的数量进行一个限制，但是主要的思想还是不变，细节不赘述。

## 多维索引

到目前位置提到的所有索引方法都是对单个属性建立一个索引，那么所有的索引都是一维的，如果我们需要同时使用多个属性进行查找，此时就需要建立多个维度上的索引。一般这个多维索引用在一些地理信息系统上，像这类系统主要需要做如下查询：

* 部分匹配查询：严格匹配条件的点
* 范围查询：某个范围的点
* 最近邻查询：与给定的点最近的点
* 自身查询：知道该点所处位置的特点。

### 网格文件

想象一下一个二维平面中，通过使用一些横线和纵线将空间划分成多个部分，每个部分通过划分的坐标来唯一确定，这样二维平面就被切割成多个部分，每个部分中散落了一些点，这就是网格文件的本质。那么对应了这些部分每个部分使用一个存储块，存储块存放了这些点的坐标。

在往这个网格文件插入数据的时候，如果遇到存储块中没有空间了，那么可以采取溢出块的方法，或者通过分裂或者是移动线的方法，重构整个区域。

### 分段散列

如果我们可以构造一个散列函数，接收的参数是多个维度的，那么就可以借助之前提出的散列方法去操作了。

### 多键索引

比如我们有两个索引，那么怎样建立这个索引结构呢，最容易想到的方法就是，先对第一个键建立一个索引，而这个指针指向了存储块是在第一个键值与该索引相同的情况下，对第二个键值建立索引，而最后该指针指向对应的存储块。

### kd-树

在多键索引的基础上，我们思考能不能用树结构来建立索引，kd树的建立基于二叉搜索树。kd-搜索树本身是一个二叉树，它的每一个节点包括了属性和值，那么根据二叉树的性质，kd树需要这么建立：所有维度的属性需要在层间交替出现，即树上不同层之间的属性是不同的，那么每一层根据某个节点将索引进行划分，而最终到达叶节点就是一个存储块，存储了许多记录。

在我们往kd树种插入新的数据时，需要进行一次树的搜索，找到指定的叶节点。如果叶节点没有空间了，那么就要对存储块进行分裂，根据某个指定的属性去对存储块中的数据进行分裂。

### 四叉树

这是一种感觉根据网格文件所延生出来的一种方法，例如如果在一个二维空间中，你可以将这个区域看作一个正方形区域，那么此时对这个正方形区域切割成四份，然乎检查每个象限中元素个数是否过多，如果超过某个阈值就递归这样切割，最后保证每个正方形块中的点数不过多就停止。

### R树

R树是基于B树提出的，而R树用来处理高维数据。比如一个二维的平面，那么R树会将这个区域分成许多的子区域，这些子区域就是所谓的数据区。而R树最擅长的就是查询某个点所处于的那个数据区域是什么样的。使用的方法就是如果我们有这么一个P，我们需要从根节点开始向下搜索是否已经存在这样的区域包含P。如果没有找到那就说明并不在任何数据区中存在P。如果我们为此要插入一个新区域的话，就需要逐个搜索合适的子区域，到达叶节点后插入区域R，如果在叶节点上已经没有空间了，那么需要对叶节点进行分裂。

## 位图索引

最后一种可能使用的索引是通过使用位图这样的数据结构来进行表示。位图的意思是尽可能压缩空间来标识某个数据是否存在。假设我们有一个向量v，而对应第i个记录的字段F的值对应这个v向量的第i位为1，否则这个位置上为0，这就是位图索引的最基本的一个思想。

之所以能够使用这样的位图索引，是因为位图索引只需要通过与运算、或运算就可以对一些区间或者指定的值进行一个查询了。但是如果使用定长的索引，那么会发现当键值一旦增多，需要的存储空间会变得非常大，所以就需要对位图索引进行一个压缩。

压缩的本质就是使用某种编码的手段减少位图中的一些冗余的信息，这里对于位图的压缩技术不展开叙述。